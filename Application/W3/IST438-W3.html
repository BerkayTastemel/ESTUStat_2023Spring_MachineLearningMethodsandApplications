<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-03-13">

<title>IST438-W3-Applications</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="IST438-W3_files/libs/clipboard/clipboard.min.js"></script>
<script src="IST438-W3_files/libs/quarto-html/quarto.js"></script>
<script src="IST438-W3_files/libs/quarto-html/popper.min.js"></script>
<script src="IST438-W3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="IST438-W3_files/libs/quarto-html/anchor.min.js"></script>
<link href="IST438-W3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="IST438-W3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="IST438-W3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="IST438-W3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="IST438-W3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">IST438-W3-Applications</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="supervised-learning-logistic-regression-models" class="level1">
<h1>Supervised Learning: Logistic Regression Models</h1>
<p>In this application, we will interest the regression problem under the following sections:</p>
<ul>
<li>Training model</li>
<li>Measuring model performance</li>
<li>Checking over and underfitting problem</li>
</ul>
</section>
<section id="packages" class="level1">
<h1>Packages</h1>
<p>We need to install <code>{DALEX}</code> package to use <code>titanic</code> data set in applications. Please use the two-step codes below: (1) install, (2) load the package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("DALEX")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("caret")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("ROCR")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DALEX)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line is <code>hashtag</code>ed to faster this process. Do not forget to un-<code>hashtag</code> it in your first run. Because any line, which is hashtaged, is not run in R. It is turned the command line!</p>
</section>
<section id="dataset" class="level1">
<h1>Dataset</h1>
<p>We use the <code>titanic</code> data set from <code>{DALEX}</code> package. The task is to predict the survival probability of the passangers in Titanic. The data set contains several informations about the passenger and their survive status.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calling titanic from {DALEX} package</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(titanic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can use <code>str()</code> function to take a look data set. It returns a data frame consists information about the data set such as:</p>
<ul>
<li>number of observation</li>
<li>number of features (variables)</li>
<li>name of features</li>
<li>type of features</li>
<li>a few observations of features</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take a look to dataset </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(titanic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   2207 obs. of  9 variables:
 $ gender  : Factor w/ 2 levels "female","male": 2 2 2 1 1 2 2 1 2 2 ...
 $ age     : num  42 13 16 39 16 25 30 28 27 20 ...
 $ class   : Factor w/ 7 levels "1st","2nd","3rd",..: 3 3 3 3 3 3 2 2 3 3 ...
 $ embarked: Factor w/ 4 levels "Belfast","Cherbourg",..: 4 4 4 4 4 4 2 2 2 4 ...
 $ country : Factor w/ 48 levels "Argentina","Australia",..: 44 44 44 15 30 44 17 17 26 16 ...
 $ fare    : num  7.11 20.05 20.05 20.05 7.13 ...
 $ sibsp   : num  0 0 1 1 0 0 1 1 0 0 ...
 $ parch   : num  0 2 1 1 0 0 0 0 0 0 ...
 $ survived: Factor w/ 2 levels "no","yes": 1 1 1 2 2 2 1 2 2 2 ...</code></pre>
</div>
</div>
<p>Remove <code>country</code> feature from the data set. It is a problematic categorical feature in model training, because it has many classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> titanic[, <span class="sc">-</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remove missing observations in the dataset or you can impute them but if the number of observations is enough, to remove missing observations is easier way to handle missing data. It is necessary because when you split data set, some of the classes may not be seen in the train set then the model can not learn anything about these classes. Thus, it is not possible to predict the value of target feature with the predictors (features) that have these unseen classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>titanic <span class="ot">&lt;-</span> <span class="fu">na.exclude</span>(titanic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="task-classification" class="level1">
<h1>Task: Classification</h1>
<p>In this application, we try to train a logistic regression model on the <code>titanic</code> data set to predict the survive probability of the passangers.</p>
<section id="step-1---splitting-the-data-set" class="level2">
<h2 class="anchored" data-anchor-id="step-1---splitting-the-data-set">Step 1 - Splitting the data set</h2>
<p>We can use <code>sample()</code> function to split the data set as <code>test</code> and <code>train</code> set. Do not forget to set a seed to reproduce this process in future. It is important to get same observations in each run of these codes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># for reproducibility</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span> <span class="sc">:</span> <span class="fu">nrow</span>(titanic), <span class="fu">round</span>(<span class="fu">nrow</span>(titanic) <span class="sc">*</span> <span class="fl">0.80</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> titanic[index, ]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> titanic[<span class="sc">-</span>index, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the codes above, we get a sample from a vector has a length is equal to the number of observation in the data set. We must input a sequence as the first argument and the ratio of the train set as the second argument. Then we can save the randomly selected values of the sequence as <code>index</code> object. We can set the observations to <code>train</code> and <code>test</code> objects by using the <code>index</code> object.</p>
</section>
<section id="step-2---train-a-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="step-2---train-a-logistic-regression-model">Step 2 - Train a logistic regression model</h2>
<p>We can use the <code>glm()</code> function to train a logistic regression model. It needs three obligatory arguments: (1) model formula, (2) data set that used to train the modeli and (3) the family distribution of the target feature. It must be setted as “binomial” in binary logistic regression models. To define the model formula like <code>y ~ x1 + x2 + ...</code> where <code>y</code> is the target variable which is interested features to predict and <code>x</code>s are the features that used the information to predict the target variable.</p>
<p>There is a tip about the model formula: you can use <code>y ~.</code> instead of defining all features you want to input to the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lr_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(survived <span class="sc">~</span> ., <span class="at">data =</span> train, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In above, we train a linear regression model by using the <code>train</code> data that we splited in previous step and the model formula. Then, we assigned the output of <code>glm()</code> function to the <code>lr_model</code> object. Do not forget that you can give another name to the model object whatever you want, because it is just an object!</p>
<p>Let see the output of the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lr_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glm(formula = survived ~ ., family = "binomial", data = train)

Coefficients:
          (Intercept)             gendermale                    age  
             3.373307              -2.609006              -0.036670  
             class2nd               class3rd         classdeck crew  
            -1.027984              -2.114790               1.008424  
classengineering crew  classrestaurant staff  classvictualling crew  
            -1.040450              -3.588824              -1.054615  
    embarkedCherbourg     embarkedQueenstown    embarkedSouthampton  
             0.705627               0.097308               0.134285  
                 fare                  sibsp                  parch  
             0.001821              -0.314243              -0.036776  

Degrees of Freedom: 1742 Total (i.e. Null);  1728 Residual
Null Deviance:      2209 
Residual Deviance: 1630     AIC: 1660</code></pre>
</div>
</div>
<p>Model output returns the information about model formula, train data, and the estimated values of model parameters under the <code>Coefficients</code> title. You can see the numeric (continuous) features with its name, but the categorical features with <code>its name + name of the category</code> such as <code>districtOchota</code>.</p>
<p>If you want to see more detail about the model, use the <code>summary()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = survived ~ ., family = "binomial", data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.5912  -0.7112  -0.5005   0.6184   2.5528  

Coefficients:
                       Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)            3.373307   0.466759   7.227 4.93e-13 ***
gendermale            -2.609006   0.173764 -15.015  &lt; 2e-16 ***
age                   -0.036670   0.005841  -6.278 3.44e-10 ***
class2nd              -1.027984   0.274634  -3.743 0.000182 ***
class3rd              -2.114790   0.270436  -7.820 5.29e-15 ***
classdeck crew         1.008424   0.384095   2.625 0.008653 ** 
classengineering crew -1.040450   0.290723  -3.579 0.000345 ***
classrestaurant staff -3.588824   0.785298  -4.570 4.88e-06 ***
classvictualling crew -1.054615   0.284424  -3.708 0.000209 ***
embarkedCherbourg      0.705627   0.320026   2.205 0.027461 *  
embarkedQueenstown     0.097308   0.384207   0.253 0.800060    
embarkedSouthampton    0.134285   0.242161   0.555 0.579217    
fare                   0.001821   0.002195   0.830 0.406790    
sibsp                 -0.314243   0.098853  -3.179 0.001478 ** 
parch                 -0.036776   0.100481  -0.366 0.714363    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2209.1  on 1742  degrees of freedom
Residual deviance: 1630.4  on 1728  degrees of freedom
AIC: 1660.4

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>It returns some statistics about the model significance such as null and residual deviances.</p>
</section>
<section id="step-3---measuring-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="step-3---measuring-model-performance">Step 3 - Measuring model performance</h2>
<p>It is necessary to check the model performance of the model on test set. Because we are interested to train such a model has a good generalizability performance. To do this, we first calculate the predicted values of the target variable on test set.</p>
<p>Do not forget to exclude the true values of the target variable from the test set!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>predicted_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(lr_model, test[,<span class="sc">-</span><span class="dv">8</span>], <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predicted_probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         3         15         21         22         42         43 
0.10741258 0.67094677 0.94424351 0.06712159 0.12602636 0.32462728 </code></pre>
</div>
</div>
<p>The <code>predicted_probs</code> vector has the predicted survive probability of the passengers. To measure the model performance, we transform the probabilities to classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>predicted_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(predicted_probs <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(predicted_classes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 3 15 21 22 42 43 
 0  1  1  0  0  0 </code></pre>
</div>
</div>
<p>Now, we can calculate the metrics based on the confusion matrix. Assume that 1 is the positive and 0 is the negative class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">&lt;-</span> <span class="fu">sum</span>(predicted_classes[<span class="fu">which</span>(test<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">"yes"</span>)] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>FP <span class="ot">&lt;-</span> <span class="fu">sum</span>(predicted_classes[<span class="fu">which</span>(test<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">"yes"</span>)] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>TN <span class="ot">&lt;-</span> <span class="fu">sum</span>(predicted_classes[<span class="fu">which</span>(test<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">"no"</span>)] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>FN <span class="ot">&lt;-</span> <span class="fu">sum</span>(predicted_classes[<span class="fu">which</span>(test<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">"no"</span>)] <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>recall      <span class="ot">&lt;-</span> TP <span class="sc">/</span> (TP <span class="sc">+</span> FN)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">&lt;-</span> TN <span class="sc">/</span> (TN <span class="sc">+</span> FP)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>precision   <span class="ot">&lt;-</span> TP <span class="sc">/</span> (TP <span class="sc">+</span> FP)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>accuracy    <span class="ot">&lt;-</span> (TN <span class="sc">+</span> TP) <span class="sc">/</span> (TP <span class="sc">+</span> FP <span class="sc">+</span> TN <span class="sc">+</span> FN)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>recall</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7788462</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>specificity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8373494</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>precision</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>accuracy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8233945</code></pre>
</div>
</div>
<p>According to the values of performance metrics, the model classifies the observations with 0.82 accuracy. Its precision is 0.6 means that the model classify only <span class="math inline">\(60\%\)</span> of the positive class, which is survived passengers in the problem, correctly. In practice this level of performance may not be satisfied.</p>
<p>In that case, we must check the imbalancedness of the classes in the target feature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(train<span class="sc">$</span>survived) <span class="sc">/</span> <span class="fu">dim</span>(train)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       no       yes 
0.6706827 0.3293173 </code></pre>
</div>
</div>
<p>It is seen that, the classes of the target feature is not balanced. Thus, it may cause that the model can learn less from the minority class, so the model could not achieve a satisfying performance on classifying of the minority class. In that case, some solution ways can be performed based on the balancing of imbalanced classes of the target variable.</p>
<p>We will learn these ways in next weeks!</p>
<p>The following steps to calculate the metrics are not user-friendly. Of course, there are many ready-to-use function to calcute these metrics in just a line of code. One of them is <code>confusionMatrix()</code> function in the <code>{caret}</code> package which is one of the most popular ML package in R.</p>
<p>This function requires an obligatory and an optional argument that you should check its value carefully. First one is a table that contains the observed and predicted class of the target variable, and the second is the positive class label. If you do not specify it, the function takes the first observations as reference. For example, you can try this while removing the second argument.</p>
<p>Let’s calculate the confusion matrix and performance metrics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(<span class="fu">table</span>(<span class="fu">ifelse</span>(test<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">"yes"</span>, <span class="st">"1"</span>, <span class="st">"0"</span>),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                      predicted_classes),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">positive =</span> <span class="st">"1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

   predicted_classes
      0   1
  0 278  23
  1  54  81
                                         
               Accuracy : 0.8234         
                 95% CI : (0.7843, 0.858)
    No Information Rate : 0.7615         
    P-Value [Acc &gt; NIR] : 0.0010805      
                                         
                  Kappa : 0.559          
                                         
 Mcnemar's Test P-Value : 0.0006289      
                                         
            Sensitivity : 0.7788         
            Specificity : 0.8373         
         Pos Pred Value : 0.6000         
         Neg Pred Value : 0.9236         
             Prevalence : 0.2385         
         Detection Rate : 0.1858         
   Detection Prevalence : 0.3096         
      Balanced Accuracy : 0.8081         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>In the output of the function, you can see some new statistics that you may not see before. The most commonly used ones are Accuracy, Sensitivity (Recall), Specificity, and Balanced Accuracy.</p>
<p>If you want to learn more about the outputs, you can check its manual: https://rdrr.io/cran/caret/man/confusionMatrix.html</p>
</section>
<section id="roc-curve" class="level2">
<h2 class="anchored" data-anchor-id="roc-curve">ROC Curve</h2>
<p>To obtain a ROC curve is not an easy task in R. We can draw it by following a few of steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an explainer (an onject in DALEX universe) </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>explain_lr <span class="ot">&lt;-</span> <span class="fu">explain</span>(<span class="at">model   =</span> lr_model,               <span class="co"># trained model </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data    =</span> test[, <span class="sc">-</span><span class="dv">8</span>],             <span class="co"># test set without target </span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y       =</span> test<span class="sc">$</span>survived <span class="sc">==</span> <span class="st">"yes"</span>, <span class="co"># observed values of target</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                                                        <span class="co"># with reference class</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">type    =</span> <span class="st">"classification"</span>,       <span class="co"># type of task</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">verbose =</span> <span class="cn">FALSE</span>)                  <span class="co"># remove some messages</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can use <code>model_performance()</code> function from <code>{DALEX}</code> package with explainer object that we created above to draw ROC curves and some others.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>performance_lr <span class="ot">&lt;-</span> <span class="fu">model_performance</span>(explain_lr)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(performance_lr, <span class="at">geom =</span> <span class="st">"roc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="IST438-W3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To calculate the area under the curve (AUC) value, just print the <code>performance_lr</code> object!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>performance_lr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Measures for:  classification
recall     : 0.6 
precision  : 0.7788462 
f1         : 0.6778243 
accuracy   : 0.8233945 
auc        : 0.8097945

Residuals:
         0%         10%         20%         30%         40%         50% 
-0.80268512 -0.31681732 -0.25757224 -0.21537708 -0.17192974 -0.12602033 
        60%         70%         80%         90%        100% 
-0.08619287  0.03598069  0.27086289  0.71399158  0.97358362 </code></pre>
</div>
</div>
<p>It is about 0.81 means that the area under the curve is equal to 0.81 because the axes range between 0 and 1. Thus the maximum value of auc can be 1, and it means that the model performance is perfect (<span class="math inline">\(100\%\)</span> accuracy)!</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>